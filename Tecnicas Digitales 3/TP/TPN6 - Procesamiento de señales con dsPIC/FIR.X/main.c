/******************************************************************************/
/* Files to Include                                                           */
/******************************************************************************/

/* Device header file */
#if defined(__XC16__)
    #include <xc.h>
#elif defined(__C30__)
    #if defined(__dsPIC33E__)
    	#include <p33Exxxx.h>
    #elif defined(__dsPIC33F__)
    	#include <p33Fxxxx.h>
    #endif
#endif


#include <stdint.h>        /* Includes uint16_t definition                    */
#include <stdbool.h>       /* Includes true/false definition                  */
#include <dsp.h>           /* Incluye libreria para DSP                       */

#include "system.h"        /* System funct/params, like osc/peripheral config */
#include "user.h"          /* User funct/params, such as InitApp              */

#define COEF 387
/******************************************************************************/
/* Global Variable Declaration                                                */
/******************************************************************************/

FIRStruct mi_filtro;
fractional coeficientes[COEF] __attribute__((space(xmemory), aligned(1024))) = 
{0x0032,0xfff9,0xffd2,0x0007,0xfffc,0xffff,0xffff,0x0000,0x0000,0xffff,0xfffe,0xfffd,0xfffd,0xfffe,0x0000,0x0003,0x0005,0x0007,0x0008,0x0006,0x0002,0xfffd,0xfff8,0xfff4,0xfff2,0xfff4,0xfff9,0x0000,0x0009,0x0010,0x0015,0x0015,0x000f,0x0006,0xfffa,0xffee,0xffe5,0xffe2,0xffe6,0xfff1,0x0000,0x0011,0x001f,0x0027,0x0027,0x001d,0x000b,0xfff5,0xffe0,0xffd2,0xffcd,0xffd4,0xffe6,0xffff,0x001b,0x0032,0x003f,0x003d,0x002d,0x0012,0xfff0,0xffd0,0xffba,0xffb2,0xffbd,0xffd8,0xfffe,0x0027,0x0048,0x005b,0x0059,0x0042,0x001a,0xffea,0xffbd,0xff9e,0xff93,0xffa2,0xffc8,0xfffc,0x0034,0x0062,0x007b,0x0078,0x005a,0x0024,0xffe5,0xffa9,0xff7f,0xff71,0xff84,0xffb5,0xfffa,0x0042,0x007d,0x009e,0x009b,0x0074,0x0030,0xffdf,0xff93,0xff5e,0xff4c,0xff64,0xffa1,0xfff6,0x0050,0x009a,0x00c2,0x00bf,0x008f,0x003d,0xffda,0xff7d,0xff3c,0xff27,0xff44,0xff8c,0xfff2,0x005d,0x00b5,0x00e6,0x00e2,0x00aa,0x004a,0xffd6,0xff69,0xff1d,0xff03,0xff24,0xff78,0xffed,0x0069,0x00cf,0x0108,0x0104,0x00c5,0x0057,0xffd3,0xff57,0xff00,0xfee2,0xff06,0xff64,0xffe8,0x0073,0x00e5,0x0125,0x0122,0x00dc,0x0063,0xffd1,0xff48,0xfee8,0xfec7,0xfeed,0xff53,0xffe2,0x007a,0x00f7,0x013d,0x013a,0x00f0,0x006d,0xffd1,0xff3e,0xfed6,0xfeb1,0xfeda,0xff46,0xffdd,0x007e,0x0103,0x014d,0x014c,0x00fe,0x0076,0xffd2,0xff38,0xfecb,0xfea4,0xfecd,0xff3c,0xffd9,0x007e,0x0108,0x0155,0x0155,0x0106,0x007c,0xffd5,0xff38,0xfec8,0x7ea0,0xfec8,0xff38,0xffd5,0x007c,0x0106,0x0155,0x0155,0x0108,0x007e,0xffd9,0xff3c,0xfecd,0xfea4,0xfecb,0xff38,0xffd2,0x0076,0x00fe,0x014c,0x014d,0x0103,0x007e,0xffdd,0xff46,0xfeda,0xfeb1,0xfed6,0xff3e,0xffd1,0x006d,0x00f0,0x013a,0x013d,0x00f7,0x007a,0xffe2,0xff53,0xfeed,0xfec7,0xfee8,0xff48,0xffd1,0x0063,0x00dc,0x0122,0x0125,0x00e5,0x0073,0xffe8,0xff64,0xff06,0xfee2,0xff00,0xff57,0xffd3,0x0057,0x00c5,0x0104,0x0108,0x00cf,0x0069,0xffed,0xff78,0xff24,0xff03,0xff1d,0xff69,0xffd6,0x004a,0x00aa,0x00e2,0x00e6,0x00b5,0x005d,0xfff2,0xff8c,0xff44,0xff27,0xff3c,0xff7d,0xffda,0x003d,0x008f,0x00bf,0x00c2,0x009a,0x0050,0xfff6,0xffa1,0xff64,0xff4c,0xff5e,0xff93,0xffdf,0x0030,0x0074,0x009b,0x009e,0x007d,0x0042,0xfffa,0xffb5,0xff84,0xff71,0xff7f,0xffa9,0xffe5,0x0024,0x005a,0x0078,0x007b,0x0062,0x0034,0xfffc,0xffc8,0xffa2,0xff93,0xff9e,0xffbd,0xffea,0x001a,0x0042,0x0059,0x005b,0x0048,0x0027,0xfffe,0xffd8,0xffbd,0xffb2,0xffba,0xffd0,0xfff0,0x0012,0x002d,0x003d,0x003f,0x0032,0x001b,0xffff,0xffe6,0xffd4,0xffcd,0xffd2,0xffe0,0xfff5,0x000b,0x001d,0x0027,0x0027,0x001f,0x0011,0x0000,0xfff1,0xffe6,0xffe2,0xffe5,0xffee,0xfffa,0x0006,0x000f,0x0015,0x0015,0x0010,0x0009,0x0000,0xfff9,0xfff4,0xfff2,0xfff4,0xfff8,0xfffd,0x0002,0x0006,0x0008,0x0007,0x0005,0x0003,0x0000,0xfffe,0xfffd,0xfffd,0xfffe,0xffff,0x0000,0x0000,0xffff,0xffff,0xfffc,0x0007,0xffd2,0xfff9,0x0032}; 

fractional delay[391] __attribute__((space(ymemory), aligned(1024)));
fractional temp[32] __attribute__((space(dma)));

unsigned int Data_ADC_BufferA[32] __attribute__((space(dma)));
unsigned int Data_ADC_BufferB[32] __attribute__((space(dma)));
unsigned int Data_DAC_BufferA[32] __attribute__((space(dma)));
unsigned int Data_DAC_BufferB[32] __attribute__((space(dma)));



/******************************************************************************/
/* Main Program                                                               */
/******************************************************************************/

int16_t main(void){

    /* Configure the oscillator for the device */
    ConfigureOscillator();
   
    /* Initialize IO ports and peripherals */
    
    Init_ADC();
    Init_DAC();
    mi_filtro.numCoeffs = COEF;                           //Numero de coeficientes
    mi_filtro.coeffsBase = coeficientes;                 //Posicion de inicio del vectot coeficientes
    mi_filtro.coeffsEnd = &((uint8_t *)coeficientes)[COEF*2-1]; //(int) mi_filtro.coeffsBase + 2 * mi_filtro.numCoeffs - 1;    //Posicion final del vector coeficientes
    mi_filtro.coeffsPage = 0xFF00;                       //0xFF00 indica que los coeficientes se almacenan en la RAM en el espacio X
    mi_filtro.delayBase = delay;                         //Posicion de inicio del vector retardos
    mi_filtro.delayEnd =  &((uint8_t *)delay)[387*2-1];//(int) mi_filtro.delayBase + 2 * mi_filtro.numCoeffs - 1;                 //Posicion final del vector retardos
    mi_filtro.delay = mi_filtro.delayBase;
    
    FIRDelayInit(&mi_filtro);                                      //Inicializa el vector de retardos
    /* TODO <INSERT USER APPLICATION CODE HERE> */

    while(1)
    {

    }
}
